if("undefined"!=typeof window.Craft&&window.Craft.username){var fields=document.querySelectorAll(".fld-field"),fieldHeadings=document.querySelectorAll("#fields .field:not(#title-field) .heading");(0<fields.length||0<fieldHeadings.length)&&(console.log("Craft Field Handles initialized"),cpFieldHandles())}function cpFieldHandles(){toggleButton(),fetch(window.Craft.baseCpUrl+"/settings/fields").then(function(a){return a.text()}).then(function(a){var b=new DOMParser,c=b.parseFromString(a,"text/html"),d=c.querySelectorAll("#fields tbody tr");if(d.length){var e=[];d.forEach(function(a){var b=a.querySelector("code").textContent,c=a.querySelector("[data-title=\"Type\"]").innerText.replace(/^\s+|\s+$/g,""),d=a.getAttribute("data-id");e.push([b,d,c])}),localStorage.setItem("fieldData",JSON.stringify(e))}}).then(function(){renderEntryHandles(),renderSectionHandles()}).then(function(){createFieldLink(),updateHandles(),copyHandles()}).catch(function(){console.log("fieldHandles Error: Failed to fetch fieldData")})}function createFieldLink(){var a=localStorage.getItem("fieldData");if(a){var b=JSON.parse(a),c=document.querySelectorAll(".fieldHandle");b.forEach(function(a){c.forEach(function(b){if(a[0]==b.value){var c="<a class=\"handleIcon\" data-icon=\"settings\" href=\""+window.Craft.baseCpUrl+"/settings/fields/edit/"+a[1]+"\" target=\"_blank\"></a>";if(b.parentNode.querySelector("legend").insertAdjacentHTML("beforeEnd",c),-1!==a[2].indexOf("Matrix")){var d="<span class=\"codeIcon\" data-field-id=\""+a[1]+"\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"14\" height=\"14\" viewBox=\"0 0 24 24\"><path d=\"M24 10.935v2.131l-8 3.947v-2.23l5.64-2.783-5.64-2.79v-2.223l8 3.948zm-16 3.848l-5.64-2.783 5.64-2.79v-2.223l-8 3.948v2.131l8 3.947v-2.23zm7.047-10.783h-2.078l-4.011 16h2.073l4.016-16z\"/></svg></span>";b.parentNode.querySelector("legend").insertAdjacentHTML("beforeEnd",d)}}})})}else console.log("fieldHandles: fields not found in localStorage")}function renderSectionHandles(){fields.forEach(function(a){var b=a.childNodes;b.forEach(function(b){if(!a.querySelector(".fieldHandles"))if("SPAN"===b.tagName){var c=b.getAttribute("title");b.parentNode.insertAdjacentHTML("beforeEnd",renderHandleHTML(c))}else console.log("fieldHandles cannot render due to Craft DOM change.")})}),document.querySelectorAll(".fld-tab").forEach(function(a){a.style.cssText="height: auto;"})}function renderEntryHandles(){fields=document.querySelectorAll(".fld-field"),fieldHeadings=document.querySelectorAll("#fields .field:not(#title-field) .heading"),codeGenerators=document.querySelectorAll(".codeIcon"),document.addEventListener("click",function(a){if(a.target&&"codeIcon"===a.target.className){var b=a.target,c=b.getAttribute("data-field-id"),d=b.parentNode.parentNode.querySelector(".fieldHandle").value;b.parentNode.parentNode.querySelector(".matrixCode")?b.parentNode.parentNode.querySelector(".matrixCode").remove():generateMatrixCode(c,d,b)}}),fieldHeadings.forEach(function(a){var b=a.childNodes;b.forEach(function(b){if(!a.querySelector(".fieldHandles")&&"LABEL"==b.tagName){var c=b.getAttribute("for").split("-").pop();b.parentNode.insertAdjacentHTML("beforeEnd",renderHandleHTML(c))}})})}function copyHandles(){var a=document.querySelectorAll(".fieldHandle");a.forEach(function(a){document.addEventListener("click",function(b){if(b.target&&b.target.className===a.className){var c=b.target.parentNode.querySelector(".legendLabel"),d=c.textContent;b.target.select(),document.execCommand("copy"),c.textContent="Copied",setTimeout(function(){c.textContent="Handle"},300)}})})}function renderHandleHTML(a){return"<fieldset class=\"fieldHandles text\"><legend><span class=\"legendLabel\">Handle</span></legend><input class=\"fieldHandle\" value=\""+a+"\" title=\"Click to copy\" readonly=\"readonly\"></fieldset>"}function toggleButton(){document.querySelector(".btn.submit").insertAdjacentHTML("beforeBegin","<div class=\"handleButton btn submit\">fieldHandles</div>");var a=document.querySelector(".handleButton");window.localStorage.getItem("cpShowHandles")&&(document.body.classList.add("showHandles"),a.classList.add("is-active")),a.addEventListener("click",function(){document.body.classList.toggle("showHandles"),window.localStorage.getItem("cpShowHandles")?(localStorage.removeItem("cpShowHandles"),a.classList.remove("is-active")):(localStorage.setItem("cpShowHandles",!0),a.classList.add("is-active"),renderEntryHandles())})}function updateHandles(){var a=document.querySelectorAll(".field .btn");a.forEach(function(a){a.addEventListener("click",function(){setTimeout(function(){renderEntryHandles()},1)})})}function generateMatrixCode(a,b,c){var d=[],e=[];fetch(window.Craft.baseCpUrl+"/settings/fields/edit/"+a+"").then(function(a){return a.text()}).then(function(a){var b=new DOMParser,c=b.parseFromString(a,"text/html"),e=c.querySelectorAll(".blocktypes .handle");e.length&&e.forEach(function(a){var b=a.textContent,e=a.parentNode.getAttribute("data-id"),f=c.querySelectorAll(".fields [data-id=\""+e+"\"] .handle"),g=[];f.forEach(function(a){g.push(a.textContent)}),d.push([b,g])})}).then(function(){e+="{% for block in "+b+" %} \n",d.forEach(function(a,b){var c=a[0],d=a[1],f=[];d&&d.forEach(function(a){f+="\xA0\xA0{{ block."+a.replace(/^\s+|\s+$/g,"")+" }} \n"}),0===b?e+="\xA0{% if block.type == '"+c+"' %} \n"+f:b<=a.length&&(e+="\xA0{% elseif block.type == '"+c+"' %} \n"+f)}),e+="\xA0{% endif %} \n",e+="{% endfor %}"}).then(function(){c.parentNode.parentNode.querySelector(".matrixCode")||c.parentNode.parentNode.insertAdjacentHTML("beforeEnd","<textarea class=\"matrixCode\" spellcheck=\"false\" readonly=\"readonly\">"+e+"</textarea>")})}
